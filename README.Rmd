---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# frontmatter

<!-- badges: start -->
[![CRAN status](https://www.r-pkg.org/badges/version/frontmatter)](https://CRAN.R-project.org/package=frontmatter)
[![R-CMD-check](https://github.com/posit-dev/frontmatter/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/posit-dev/frontmatter/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

## Overview

`frontmatter` extracts and parses structured metadata (YAML or TOML) from the beginning of text documents. Front matter is a common pattern in static site generators, documentation systems, and content management tools where metadata is placed at the top of a document, separated from the main content by delimiter fences.

## Features

- **Fast C++ parsing** for optimal performance
- **Multiple formats supported:**
  - Standard YAML (`---` delimiters)
  - Standard TOML (`+++` delimiters)
  - Comment-wrapped formats for R and Python files (`#` and `#'` prefixes)
  - PEP 723 Python inline script metadata
- **Flexible parser integration** - use default parsers or provide your own
- **Graceful handling** of invalid front matter

## Installation

You can install the development version of frontmatter from [GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("posit-dev/frontmatter")
```

## Usage

### Basic Usage

```md
---
title: My Document
date: 2024-01-01
tags:
  - tutorial
  - R
---

Document content starts here.
```

```{r}
#| echo: [6]
library(frontmatter)

# Parse YAML front matter
text_yaml <- "---
title: My Document
date: 2024-01-01
tags:
  - tutorial
  - R
---

Document content starts here."

str(parse_front_matter(text_yaml))
```

### Parse from File

```r
result <- read_front_matter("document.md")
```

### TOML Front Matter

```md
+++
title = 'My Document'
count = 42
+++

Content here
```

```{r}
#| echo: [3]

text_toml <- "+++
title = 'My Document'
count = 42
+++

Content here"

str(parse_front_matter(text_toml))
```

### Comment-Wrapped Formats

For R and Python files, front matter can be wrapped in comments:

```r
# ---
# title: My Analysis
# author: Data Scientist
# ---

library(dplyr)
# Analysis code...
```

```{r}
#| echo: [4]
# R file with front matter
text_r <- "# ---
# title: My Analysis
# author: Data Scientist
# ---

library(dplyr)
# Analysis code..."

str(parse_front_matter(text_r))
```

Roxygen-style comments are also supported:

```r
#' ---
#' title: My Function
#' ---
#'
#' Documentation here
```

```{r}
#| echo: [3]
text_roxy <- "#' ---
#' title: My Function
#' ---
#'
#' Documentation here"

str(parse_front_matter(text_roxy))
```

### PEP 723 Python Metadata

```py
# /// script
# requires-python = ">=3.11"
# dependencies = [
#     "requests<3",
# ]
# ///

import requests
```

```{r}
#| echo: [3]
text_py <- "# /// script
# requires-python = \">=3.11\"
# dependencies = [
#     \"requests<3\",
# ]
# ///

import requests"

str(parse_front_matter(text_py))
```

### Custom Parsers

```{r}
# Get raw YAML without parsing
identity_parser <- front_matter_parsers(yaml = identity)
str(parse_front_matter(text_yaml, parsers = identity_parser))

# Use a custom parser that adds metadata
metadata_parser <- front_matter_parsers(
  yaml = function(x) {
    data <- yaml12::parse_yaml(x)
    data$parsed_at <- Sys.time()
    data
  }
)

str(parse_front_matter(text_yaml, parsers = metadata_parser))
```

## Default Parsers

- **YAML**: Uses `yaml12::parse_yaml()` with YAML 1.2 support
- **TOML**: Uses `toml::parse_toml()`

## Error Handling

Invalid front matter returns `NULL` as data and the original content unchanged:

```{r}
text <- "---\nNot valid front matter"
str(parse_front_matter(text))
```

Parser errors propagate to the caller for proper error handling.

## Performance

The package uses C++11 for optimal performance:

- Single-pass parsing
- Minimal string copying
- Efficient fence detection and validation

Designed for high throughput processing of many documents.
